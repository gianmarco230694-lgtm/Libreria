<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Libreria</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icona.jpg">
<meta name="theme-color" content="#f2ede4">
</head>
    <style>
        :root {
            --primary: #ff85a1;
            --secondary: #fce4ec;
            --text: #4a4a4a;
            --bg: #fff5f7;
            --white: #ffffff;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding-bottom: 80px;
        }

        .page { display: none; padding: 20px; max-width: 500px; margin: auto; animation: fadeIn 0.3s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { text-align: center; color: var(--primary); font-size: 2.2em; margin-bottom: 10px; }
        h2 { color: var(--primary); border-bottom: 2px solid var(--secondary); padding-bottom: 10px; margin-top: 0; }

        label { font-weight: bold; display: block; margin-top: 15px; color: var(--primary); }
        input, textarea { 
            width: 100%; padding: 12px; border: 2px solid var(--secondary); 
            border-radius: 12px; box-sizing: border-box; font-size: 16px; margin-top: 5px;
            outline: none;
        }
        input:focus { border-color: var(--primary); }
        
        /* Stile barra di ricerca */
        .search-bar { 
            background: white; border: 2px solid var(--primary); 
            margin-bottom: 20px; border-radius: 25px; padding-left: 20px;
        }

        textarea { height: 100px; resize: none; word-wrap: break-word; white-space: pre-wrap; }

        .source-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .btn-source { 
            padding: 12px; border: 2px solid var(--primary); border-radius: 12px; 
            background: var(--white); cursor: pointer; text-align: center; font-weight: bold;
        }
        .btn-source.selected { background: var(--primary); color: white; }

        .stars { font-size: 40px; text-align: center; margin: 10px 0; cursor: pointer; width: 100%; }
        .stars span { display: inline-block; color: #ddd; transition: color 0.2s; }
        .stars span.active { color: #ffca28; }

        .btn-main { 
            background: var(--primary); color: white; border: none; padding: 16px; 
            width: 100%; border-radius: 50px; font-size: 18px; font-weight: bold; 
            cursor: pointer; margin-top: 15px; box-shadow: 0 4px 10px rgba(255,133,161,0.2);
        }
        .btn-secondary { background: #bbb; }
        .btn-delete { background: #ff5252; }
        .btn-edit { background: #4caf50; }

        .book-card { 
            background: var(--white); padding: 15px; margin-bottom: 15px; 
            border-radius: 15px; border-left: 6px solid var(--primary);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer;
            position: relative;
        }
        .book-card h3 { margin: 0; color: var(--primary); font-size: 1.1em; padding-right: 25px; }
        .book-card p { margin: 5px 0 0 0; font-size: 0.9em; opacity: 0.8; }

        .delete-x { position: absolute; top: 15px; right: 15px; color: #ff5252; font-weight: bold; font-size: 20px; cursor: pointer; }

        .navbar { 
            position: fixed; bottom: 0; width: 100%; background: var(--white); 
            display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #eee;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .nav-btn { background: none; border: none; color: #aaa; font-weight: bold; cursor: pointer; font-size: 14px; }
        .nav-btn.active { color: var(--primary); }

        .note-display { background: var(--secondary); padding: 15px; border-radius: 12px; font-style: italic; margin-top: 10px; word-wrap: break-word; }
    </style>
</head>
<body>

    <div id="page-list" class="page active">
        <h1>Libreria Titti</h1>
        
        <input type="text" id="search-input" class="search-bar" placeholder="ðŸ” Cerca titolo, autore o editore..." onkeyup="renderList()">
        
        <button class="btn-main" onclick="openNewForm()">+ Aggiungi Libro Letto</button>
        <div id="books-container" style="margin-top: 20px;"></div>
    </div>

    <div id="page-form" class="page">
        <h2 id="form-title">Nuovo Libro Letto</h2>
        <label>Titolo</label><input type="text" id="in-title" placeholder="Es: Il barone rampante">
        <label>Autore</label><input type="text" id="in-author" placeholder="Es: Italo Calvino">
        <label>Editore</label><input type="text" id="in-publisher" placeholder="Es: Mondadori">
        
        <label>Dove l'hai preso?</label>
        <div class="source-grid">
            <div class="btn-source" onclick="setSource('Comprato', this)">Comprato</div>
            <div class="btn-source" onclick="setSource('Biblioteca', this)">Biblioteca</div>
            <div class="btn-source" onclick="setSource('Gabbiotto', this)">Gabbiotto</div>
            <div class="btn-source" onclick="setSource('Prestito', this)">Prestito</div>
        </div>
        
        <label>Voto</label>
        <div class="stars" id="star-input">
            <span onclick="setRating(1)">â˜…</span><span onclick="setRating(2)">â˜…</span><span onclick="setRating(3)">â˜…</span><span onclick="setRating(4)">â˜…</span><span onclick="setRating(5)">â˜…</span>
        </div>
        
        <label>Note / Recensione</label><textarea id="in-notes" placeholder="Cosa ne pensi?"></textarea>
        
        <input type="hidden" id="edit-index">
        <button class="btn-main" onclick="saveData()">Salva nella Libreria</button>
        <button class="btn-main btn-secondary" onclick="navigate('page-list')">Annulla</button>
    </div>

    <div id="page-detail" class="page">
        <h2>Scheda Libro</h2>
        <div id="detail-box" style="background: white; padding: 20px; border-radius: 20px;"></div>
        <div style="display: flex; gap: 10px;">
            <button id="edit-btn" class="btn-main btn-edit">Modifica</button>
            <button id="delete-btn" class="btn-main btn-delete">Elimina</button>
        </div>
        <button class="btn-main btn-secondary" onclick="navigate('page-list')">Torna Indietro</button>
    </div>

    <div id="page-wish" class="page">
        <h1>Desideri âœ¨</h1>
        <div style="background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
            <label>Titolo</label><input type="text" id="wish-title" placeholder="Titolo del libro">
            <label>Autore</label><input type="text" id="wish-author" placeholder="Autore">
            <label>Editore</label><input type="text" id="wish-publisher" placeholder="Editore">
            <button class="btn-main" onclick="saveWish()">Aggiungi Desiderio</button>
        </div>
        <div id="wish-container" style="margin-top: 20px;"></div>
    </div>

    <nav class="navbar">
        <button class="nav-btn active" id="nav-list" onclick="navigate('page-list')">ðŸ“š LETTI</button>
        <button class="nav-btn" id="nav-wish" onclick="navigate('page-wish')">âœ¨ DESIDERI</button>
    </nav>

    <script>
        let myBooks = JSON.parse(localStorage.getItem('titti_data')) || [];
        let myWishes = JSON.parse(localStorage.getItem('titti_wishes')) || [];
        let tempSource = "";
        let tempRating = 0;

        function navigate(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(pageId === 'page-list') { document.getElementById('nav-list').classList.add('active'); renderList(); }
            if(pageId === 'page-wish') { document.getElementById('nav-wish').classList.add('active'); renderWishes(); }
        }

        function openNewForm() {
            document.getElementById('edit-index').value = "";
            document.getElementById('form-title').innerText = "Nuovo Libro Letto";
            document.getElementById('in-title').value = "";
            document.getElementById('in-author').value = "";
            document.getElementById('in-notes').value = "";
            document.getElementById('in-publisher').value = "";
            setSource("", null);
            setRating(0);
            navigate('page-form');
        }

        function setSource(val, el) {
            tempSource = val;
            document.querySelectorAll('.btn-source').forEach(b => b.classList.remove('selected'));
            if(el) el.classList.add('selected');
        }

        function setRating(n) {
            tempRating = n;
            const stars = document.querySelectorAll('#star-input span');
            stars.forEach((s, i) => s.classList.toggle('active', i < n));
        }

        function saveData() {
            const title = document.getElementById('in-title').value;
            if(!title) { alert("Mamma, metti il titolo!"); return; }
            const book = { 
                title, 
                author: document.getElementById('in-author').value || "Ignoto", 
                publisher: document.getElementById('in-publisher').value || "Non specificato", 
                source: tempSource, 
                rating: tempRating, 
                notes: document.getElementById('in-notes').value 
            };
            const index = document.getElementById('edit-index').value;
            if(index === "") myBooks.push(book); else myBooks[index] = book;
            localStorage.setItem('titti_data', JSON.stringify(myBooks));
            navigate('page-list');
        }

        function renderList() {
            const container = document.getElementById('books-container');
            const term = document.getElementById('search-input').value.toLowerCase();
            container.innerHTML = "";
            
            const filtered = myBooks.filter(b => 
                b.title.toLowerCase().includes(term) || 
                b.author.toLowerCase().includes(term) || 
                b.publisher.toLowerCase().includes(term)
            );

            if(filtered.length === 0) {
                container.innerHTML = "<p style='text-align:center; opacity:0.5'>Nessun libro trovato.</p>";
            }

            filtered.forEach((b, i) => {
                const originalIndex = myBooks.indexOf(b);
                const card = document.createElement('div');
                card.className = 'book-card';
                card.onclick = () => showDetail(originalIndex);
                card.innerHTML = `<h3>${b.title}</h3><p>${b.author} â€¢ <i>${b.publisher}</i></p><p style="color:#ffca28">${"â˜…".repeat(b.rating)}${"â˜†".repeat(5-b.rating)}</p>`;
                container.appendChild(card);
            });
        }

        function showDetail(i) {
            const b = myBooks[i];
            document.getElementById('detail-box').innerHTML = `
                <p><strong>Titolo:</strong> ${b.title}</p>
                <p><strong>Autore:</strong> ${b.author}</p>
                <p><strong>Editore:</strong> ${b.publisher}</p>
                <p><strong>Provenienza:</strong> ${b.source || '-'}</p>
                <p><strong>Voto:</strong> ${"â˜…".repeat(b.rating)}</p>
                <p><strong>Note:</strong></p>
                <div class="note-display">${b.notes || 'Nessuna nota.'}</div>
            `;
            document.getElementById('delete-btn').onclick = () => { if(confirm("Eliminare definitivamente?")) { myBooks.splice(i, 1); localStorage.setItem('titti_data', JSON.stringify(myBooks)); navigate('page-list'); } };
            document.getElementById('edit-btn').onclick = () => {
                document.getElementById('edit-index').value = i;
                document.getElementById('in-title').value = b.title;
                document.getElementById('in-author').value = b.author;
                document.getElementById('in-publisher').value = b.publisher;
                document.getElementById('in-notes').value = b.notes;
                setRating(b.rating);
                document.querySelectorAll('.btn-source').forEach(btn => { if(btn.innerText === b.source) setSource(b.source, btn); });
                document.getElementById('form-title').innerText = "Modifica Libro";
                navigate('page-form');
            };
            navigate('page-detail');
        }

        function saveWish() {
            const title = document.getElementById('wish-title').value;
            if(!title) return;
            const wish = {
                title: title,
                author: document.getElementById('wish-author').value || "Ignoto",
                publisher: document.getElementById('wish-publisher').value || "Non specificato"
            };
            myWishes.push(wish);
            localStorage.setItem('titti_wishes', JSON.stringify(myWishes));
            document.getElementById('wish-title').value = "";
            document.getElementById('wish-author').value = "";
            document.getElementById('wish-publisher').value = "";
            renderWishes();
        }

        function renderWishes() {
            const container = document.getElementById('wish-container');
            container.innerHTML = "";
            myWishes.forEach((w, i) => {
                const card = document.createElement('div');
                card.className = 'book-card';
                card.style.borderLeftColor = "#ffca28";
                card.innerHTML = `
                    <span class="delete-x" onclick="deleteWish(${i})">âœ–</span>
                    <h3>${w.title}</h3>
                    <p><strong>Autore:</strong> ${w.author}</p>
                    <p><strong>Editore:</strong> ${w.publisher}</p>
                `;
                container.appendChild(card);
            });
        }

        function deleteWish(i) {
            event.stopPropagation();
            if(confirm("Rimuovere dai desideri?")) {
                myWishes.splice(i, 1);
                localStorage.setItem('titti_wishes', JSON.stringify(myWishes));
                renderWishes();
            }
        }

        renderList();
    </script>
</body>
</html>
